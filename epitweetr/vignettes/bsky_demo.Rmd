---
title: "bluesky_demo"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{bluesky_demo}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(epitweetr)
```


# Authentification

Your bluesky account is used to authenticate to the API.

The bluesky handle and password are stored in the environment variables `bluesky_id` and `bluesky_pwd`.

```{r, eval=FALSE}
handle <- Sys.getenv("bluesky_id")
password <- Sys.getenv("bluesky_pwd")

infos <- bluesky_create_session(handle, password)
token <- infos$access_jwt
```

# Retrieve posts

## Make a simple request

```{r, eval=FALSE}
posts <- bluesky_search(
  query = "covid19",
  token = token,
  plan = list(
    since = NULL,
    until = NULL
  )
)
```

### Analyze the content of the posts

```{r, eval=FALSE}
posts_content <- posts$results$posts
elements <- bluesky_extract_many_posts_elements(posts_content)
elements[[1]]
```

`bluesky_extract_many_posts_elements` is a function that extracts the elements from the posts.

It calls `bluesky_extract_post_elements` for each post, which calls many other functions to extract the elements from the post.



# Data provided in the package

```{r}
posts <- jsonlite::read_json(system.file(package = "epitweetr", "bsky_sample", "posts.json"))
```


# Search topic

A schema explaining the logic behind the search topic function is available in the file `inst/schema/search_topic.excalidraw`. Please download this file and drag and drop it in your browser at [excalidraw](https://excalidraw.com/).

